:- begin_tests(checks).
:- use_module('../../src/board').
:- use_module('../../src/rules').
:- use_module('../../src/checks').

test(is_in_check) :-
    Board = [
        ['.', '.', '.', 'p', 'k', 'p', '.', '.'],
        ['.', '.', '.', 'p', 'p', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', 'Q', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.']
    ],
    is_in_check(Board, black).

test(is_checkmate) :-
    Board = [
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', 'R', '.', '.', '.', '.'],
        ['.', '.', '.', '.', 'k', '.', '.', '.'],
        ['.', '.', '.', 'Q', '.', 'Q', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.']
    ],
    is_checkmate(Board, black, []).

test(is_not_stalemate, [fail]) :-
    Board = [
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', 'k', '.', '.', '.'],
        ['.', '.', '.', 'Q', '.', 'Q', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.']
    ],
    is_stalemate(Board, black, []).

test(is_not_check) :-
    Board = [
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', 'k', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', 'Q', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.']
    ],
    \+is_in_check(Board,black).

test(complex_check) :-
    Board = [
        ['.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', 'p', '.'],
        ['.', '.', '.', 'R', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', 'r', '.', '.'],
        ['.', '.', '.', 'B', 'k', '.', '.', '.'],
        ['.', '.', '.', '.', 'Q', '.', 'p', '.'],
        ['.', '.', '.', 'p', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.']
    ],
    \+is_checkmate(Board, black, []).

:- end_tests(checks).
